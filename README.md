# TCP图像传输程序 - 完整功能版本

**版本：v3.1.0**  
**更新时间：2025-01-15**  
**主要功能：TCP图像接收、显示、智能重连、网络调试、串口指令控制、增强串口配置**

## 🎯 项目概述

TCPImg 是一个基于Qt框架开发的多功能网络图像传输和调试程序。该程序集成了TCP图像接收、网络调试和串口指令控制三大核心功能，特别适用于工业监控、远程图像传输、设备调试等场景。

## ✨ 核心功能特性

### 📡 **图像传输功能**
- **TCP图像接收**：实时接收和显示网络图像数据
- **动态分辨率**：支持1-8192×1-8192像素，最大50MB/图像
- **多通道支持**：1-8通道，8bit深度
- **智能重连**：自动检测断线并重连
- **图像缩放**：支持缩放、适应窗口、实际大小显示

### 🔧 **网络调试功能**
- **双模式支持**：客户端模式和服务器模式
- **多格式显示**：原始文本、十六进制、二进制、ASCII、JSON
- **实时统计**：连接状态、传输速率、数据包计数
- **时间戳标记**：可选的时间戳显示功能

### ��️ **串口指令控制功能** ⭐ **v3.1.0增强功能**
- **39字节时间显示指令**：支持实时时间字符显示控制
- **完整串口配置**：支持20种波特率、数据位、停止位、校验位、流控制
- **可编辑接收区域**：支持编辑模式、右键菜单、数据保存
- **开启/关闭控制**：独立的开启和关闭字符显示按钮
- **自动切换模式**：每秒自动在开启/关闭状态间切换
- **实时预览**：指令预览和详细解析
- **校验和验证**：自动计算和验证指令校验和

## 🚀 **v3.1 重大更新** ⭐ **最新版本**

### 增强串口配置功能
1. **完整串口参数配置**：
   - **波特率选项**：支持20种常用波特率(1200-2000000) + 自定义波特率输入
   - **数据位配置**：5位/6位/7位/8位
   - **停止位配置**：1位/1.5位/2位
   - **校验位配置**：无校验/奇校验/偶校验/标记校验/空格校验
   - **流控制配置**：无流控/硬件流控/软件流控

2. **增强接收数据编辑功能**：
   - **编辑模式开关**：可切换接收数据区域的只读/编辑状态
   - **右键菜单功能**：支持复制、粘贴、剪切、全选、清空等操作
   - **数据保存功能**：保存接收数据到文件，包含详细的头信息和配置参数
   - **视觉提示**：编辑模式时背景色变化，直观显示当前状态

3. **改进串口连接显示**：
   - **详细配置信息**：连接成功后显示完整的串口配置参数
   - **格式化显示**：清晰的参数格式化显示

4. **Qt版本兼容性优化**：
   - **跨版本支持**：同时支持Qt 5.x和Qt 6.x的API差异
   - **编码处理**：Qt 5使用setCodec，Qt 6使用setEncoding

### 新增串口测试工具
- **独立测试程序**：提供独立的串口接收测试工具
- **自动化编译脚本**：`build_serial_test.sh`编译脚本

## 🚀 **v3.0 重大更新**

### 新增串口指令控制模块
1. **39字节指令格式**：
   ```
   字节0-3: 90 EB 64 00 (固定帧头)
   字节4-5: E9 07 (年份2025，小端序)
   字节6-7: 06 0E (月日，如6月14日)
   字节8: 0F (控制字符显示)
   字节9: 00=开启显示, 01=关闭显示
   字节10-13: 时分秒毫秒 (实时时间)
   字节14-37: 00×24 (填充字节)
   字节38: 校验和 (前38字节累加和低8位)
   ```

2. **三种控制模式**：
   - **手动开启**：`⏰ 发送开启字符显示` 按钮
   - **手动关闭**：`🚫 发送关闭字符显示` 按钮  
   - **自动切换**：`🔄 开始自动切换` 按钮（每秒切换）

3. **智能功能**：
   - 实时时间更新
   - 自动校验和计算
   - 串口状态检测
   - 详细日志记录

## 📋 技术架构

### 核心组件

1. **主程序模块**
   - `main.cpp`: 程序入口
   - `dialog.h/cpp`: 主界面控制
   - `dialog.ui`: 界面布局

2. **图像传输模块**
   - `ctcpimg.h/cpp`: TCP图像传输核心
   - `sysdefine.h`: 系统参数定义

3. **网络调试模块**
   - `tcpdebugger.h/cpp`: TCP调试器
   - `dataformatter.h/cpp`: 数据格式化

4. **项目配置**
   - `TCPImg.pro`: Qt项目配置
   - `build_linux.sh`: Linux编译脚本

## 🔧 安装和使用

### 环境要求
- **Qt版本**：Qt 5.12+ 或 Qt 6.x
- **编译器**：支持C++11的编译器
- **操作系统**：Windows 10+, Linux (Ubuntu 18.04+)
- **依赖模块**：Qt Network, Qt SerialPort, Qt Widgets

### Windows编译
```bash
# 使用Qt Creator打开项目
# 或命令行编译：
qmake TCPImg.pro
make
```

### Linux编译
```bash
# 使用自动编译脚本（推荐）
chmod +x build_linux.sh
./build_linux.sh

# 或手动编译
mkdir build && cd build
qmake ../TCPImg.pro
make -j$(nproc)
```

## 📖 使用指南

### 图像传输使用
1. **连接设置**：输入服务器IP和端口
2. **分辨率配置**：设置图像宽度、高度、通道数
3. **开始连接**：点击连接按钮开始接收图像
4. **图像显示**：支持缩放、适应窗口等显示模式

### 网络调试使用
1. **模式选择**：选择客户端或服务器模式
2. **连接配置**：设置IP地址和端口
3. **数据格式**：选择数据显示格式
4. **开始调试**：发送和接收调试数据

### 串口指令控制使用 ⭐ **v3.1.0增强**
1. **串口详细设置**：
   - **基本配置**：选择串口设备
   - **波特率设置**：从下拉列表选择或输入自定义波特率
   - **高级参数**：配置数据位、停止位、校验位、流控制
   - **连接串口**：点击"打开串口"建立连接

2. **字符显示控制**：
   - **开启显示**：点击绿色按钮发送开启指令
   - **关闭显示**：点击红色按钮发送关闭指令
   - **自动切换**：点击蓝色按钮启动每秒自动切换

3. **接收数据管理**：
   - **编辑模式**：勾选"编辑模式"开关可编辑接收数据
   - **右键操作**：在接收区域右键使用复制、粘贴等功能
   - **保存数据**：右键选择"保存到文件"导出接收数据

4. **实时监控**：
   - 查看指令预览和解析
   - 监控发送/接收数据
   - 查看统计信息

## 📊 指令格式详解

### 39字节指令结构
```
示例指令: 90 EB 64 00 E9 07 06 0E 0F 00 12 0F 14 51 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 78

解析：
- 帧头: 90 EB 64 00
- 年份: E9 07 → 2025年 (小端序)
- 月日: 06 0E → 6月14日
- 控制: 0F (字符显示控制)
- 状态: 00 (开启显示)
- 时间: 12 0F 14 51 → 18:15:20.810
- 填充: 00×24 (24个字节)
- 校验: 78 (前38字节累加和)
```

### 自动切换工作流程
```
启动自动切换 →
发送开启指令(校验和78) → 等待1秒 →
发送关闭指令(校验和79) → 等待1秒 →
发送开启指令(校验和78) → 等待1秒 →
...循环直到手动停止
```

## 🐛 故障排除

### 常见问题
1. **串口连接失败**：检查串口是否被其他程序占用
2. **指令发送失败**：确认串口连接状态和波特率设置
3. **校验和错误**：程序会自动计算正确的校验和
4. **图像显示异常**：检查分辨率设置和网络连接

### 调试建议
1. 查看程序调试输出日志
2. 使用网络调试功能测试连接
3. 检查串口设备管理器状态
4. 验证指令格式和校验和

## 📈 性能指标

- **图像传输**：支持1280×1024×2通道×20fps (400Mbps)
- **串口通信**：支持9600-921600波特率
- **指令处理**：毫秒级响应时间
- **内存占用**：根据图像大小动态分配，最大50MB

## 🔄 版本历史

- **v3.1.0** (2025-01-15): 增强串口配置和接收数据编辑功能
- **v3.0.0** (2025-01-15): 新增串口指令控制和自动切换功能
- **v2.2.4** (2024-01-15): 图像缩放和分辨率预设功能
- **v2.0.0** (2024-01-10): 集成网络调试工具
- **v1.0.0** (2024-01-01): 基础TCP图像传输功能

## 📞 技术支持

- **项目地址**：https://github.com/your-username/TCPImg
- **问题反馈**：通过GitHub Issues提交
- **功能建议**：欢迎提交Pull Request

## 📄 许可证

本项目采用MIT许可证，详见LICENSE文件。

---

**开发团队**：TCP图像传输项目组  
**最后更新**：2025年1月15日 